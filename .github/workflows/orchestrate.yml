name: Orchestrate children

on:
  workflow_dispatch:

jobs:
  fanout:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repo: [service-a-dumbo, service-b-dumbo]
    steps:
      - name: Correlation id
        id: corr
        run: echo "id=${{ github.run_id }}" >> "$GITHUB_OUTPUT"

      - name: Trigger ${{ matrix.repo }}
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.PAT }}
          repository: b3tameche/${{ matrix.repo }}
          event-type: build-external
          client-payload: |
            { "corr": "${{ steps.corr.outputs.id }}" }
